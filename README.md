<!-- markdownlint-disable -->
# terraform-cloudinit-tor
[![pipeline status](https://gitlab.com/sr2c/terraform-cloudinit-tor/badges/main/pipeline.svg?ignore_skipped=true&style=flat-square)](https://gitlab.com/sr2c/terraform-cloudinit-tor/-/pipelines)
[![latest release](https://gitlab.com/sr2c/terraform-cloudinit-tor/-/badges/release.svg?style=flat-square)](https://gitlab.com/sr2c/terraform-cloudinit-tor/-/tags)
[![gitlab stars](https://img.shields.io/gitlab/stars/sr2c/terraform-cloudinit-tor?style=flat-square)](https://gitlab.com/sr2c/terraform-cloudinit-tor/-/starrers)
[![gitlab forks](https://img.shields.io/gitlab/forks/sr2c/terraform-cloudinit-tor?style=flat-square)](https://gitlab.com/sr2c/terraform-cloudinit-tor/-/forks)
<!-- markdownlint-restore -->
[![SR2 Communications Limited][logo]](https://www.sr2.uk/)

[![README Header][readme_header_img]][readme_header_link]
<!--

  ** DO NOT EDIT THIS FILE
  **
  ** This file was automatically generated by the `build-harness`.
  ** 1) Make all changes to `README.yaml`
  ** 2) Run `make init` (you only need to do this once)
  ** 3) Run`make readme` to rebuild this file.
  **
  ** (We maintain HUNDREDS of projects. This is how we maintain our sanity.)
  **

-->

Generates cloud-init user data for a Tor server (relay or bridge) using the latest stable Debian release. It
*may* also work with Debian derivatives but has not been tested with anything other than Debian. You may want to
check out the [sr2c/torrc](https://registry.terraform.io/modules/sr2c/torrc/) and
[sr2c/contactinfo](https://registry.terraform.io/modules/sr2c/contactinfo) modules for generating
torrc configuration files and
[ContactInfo Information Sharing Specification](https://nusenu.github.io/ContactInfo-Information-Sharing-Specification/)
lines respectively.

The tor package will be installed from the official Tor Project Debian repository at deb.torproject.org. The signing
key for the repository is included in this module.

The `obfs4proxy` and `nyx` packages can be installed by setting the respective inputs. For obfs4proxy, an apt
preference file is installed to always enable the use of stable backports. This will only work on Debian and on
other derivatives (e.g. Ubuntu) an older version of obfs4proxy would be installed from the available repositories.
Additional packages may also be installed using the `additional_packages` input.

The configuration will also change the default congestion control algorithm to BBR as it has been observed to perform
better in many of the scenarios where Tor is used. If this is really a problem then please submit an issue and it
could be made optional.

---
It's 100% Open Source and licensed under the [BSD 2-clause License](LICENSE).

## Usage
```
module "user_data" {
  source = "sr2c/tor/cloudinit"
  # TODO: version = "x.x.x"
  torrc  = <<-EOT
  Nickname    TerraformRelay
  ORPort      9001
  ContactInfo email@example.com
  EOT
}
```

<!-- markdownlint-disable -->
## Makefile Targets
```text
Available targets:

  help                                Help screen
  help/all                            Display help for all targets
  help/short                          This help short screen
  lint                                Lint terraform code

```
<!-- markdownlint-restore -->


<!-- markdownlint-disable -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 0.15.0 |
| <a name="requirement_cloudinit"></a> [cloudinit](#requirement\_cloudinit) | >= 2.2.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_cloudinit"></a> [cloudinit](#provider\_cloudinit) | >= 2.2.0 |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [cloudinit_config.this](https://registry.terraform.io/providers/hashicorp/cloudinit/latest/docs/data-sources/config) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_additional_packages"></a> [additional\_packages](#input\_additional\_packages) | A list of additional packages to be installed using apt. | `list(string)` | `[]` | no |
| <a name="input_gzip"></a> [gzip](#input\_gzip) | Compress the final user-data with gzip. | `bool` | `true` | no |
| <a name="input_install_nyx"></a> [install\_nyx](#input\_install\_nyx) | Install the nyx package using apt. | `bool` | `false` | no |
| <a name="input_install_obfs4proxy"></a> [install\_obfs4proxy](#input\_install\_obfs4proxy) | Install the obfs4proxy package using apt. | `bool` | `false` | no |
| <a name="input_tailscale_auth_key"></a> [tailscale\_auth\_key](#input\_tailscale\_auth\_key) | The Tailscale auth key used to join the machine to the Tailnet. Leave as null if Tailscale should not be installed. | `string` | `null` | no |
| <a name="input_tailscale_tags"></a> [tailscale\_tags](#input\_tailscale\_tags) | A list of Tailscale tags to apply to the new server. Each tag must start with 'tag:'. | `list(string)` | `[]` | no |
| <a name="input_torrc"></a> [torrc](#input\_torrc) | The torrc configuration file to be installed. | `string` | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_rendered"></a> [rendered](#output\_rendered) | The final rendered cloud-init user data. |
<!-- markdownlint-restore -->

## Share the Love

Like this project? Please give it a ★ on
[our GitLab](https://gitlab.com/sr2c/terraform-cloudinit-tor)!
(it helps us **a lot**)## Related Projects

Check out these related projects.

- [terraform-null-torrc](https://gitlab.com/sr2c/terraform-null-torrc/) - Terraform module used in this module to create the torrc configuration file.
- [terraform-null-contactinfo](https://gitlab.com/sr2c/terraform-null-contactinfo/) - Terraform module that can be used to create a Tor ContactInfo-Information-Sharing-Speicifcation compliant contact info string.

## Help

**Got a question?** We got answers.

File a
[GitLab issue](https://gitlab.com/sr2c/terraform-cloudinit-tor/-/issues),
send us an [email][email] or join our [IRC](#irc).

[![README Commercial Support][readme_commercial_support_img]][readme_commercial_support_link]

## IRC

[![IRC badge](https://img.shields.io/badge/libera.chat-%23sr2-blueviolet?style=flat-square)][irc]

Join our [public chat][irc] on IRC.
If you don't have an IRC client already, you can get started with the
[web client](https://web.libera.chat/#sr2).
This is the best place to talk shop, ask questions, solicit feedback, and work
together as a community to build on our open source code.

## Contributing

### Bug Reports & Feature Requests

Please use the
[issue tracker](https://gitlab.com/sr2c/terraform-cloudinit-tor/-/issues)
to report any bugs or file feature requests.

### Developing

If you are interested in being a contributor and want to get involved in
developing this project or help out with our other projects, we would love to
hear from you!
Shoot us an [email][email].

In general, MRs are welcome. We follow the typical "fork-and-pull" Git workflow:

 1. **Fork** the repo on GitLab
 2. **Clone** the project to your own machine
 3. **Commit** changes to your own branch
 4. **Push** your work back up to your fork
 5. Submit a **Merge Request** so that we can review your changes

**NOTE:** Be sure to merge the latest changes from "upstream" before making a
pull request!

We have adopted the
[Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/)
specification for the formatting of commit messages.

## Copyright

Copyright © 2021-2024 SR2 Communications Limited

## License

![License: BSD 2-clause](https://img.shields.io/badge/License-BSD%202--clause-blue?style=flat-square)

```text
Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.

2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
```

## Trademarks

All other trademarks referenced herein are the property of their respective owners.

## About

This project is maintained by [SR2 Communications Limited][website].

[![SR2 Communications Limited][logo]][website]

We're a [DevOps services][website] company based in Aberdeen, Scotland. We
specialise in solutions for online freedom, digital sovereignty and
anti-censorship.

We offer [paid support][website] on all of our projects.

Check out [our other projects][gitlab], or [hire us][website] to get support
with using our projects.

## Contributors

<!-- markdownlint-disable -->
|  [![irl][irlxyz_avatar]][irlxyz_homepage]<br/>[irl][irlxyz_homepage] |
|---|

  [irlxyz_homepage]: https://gitlab.com/irlxyz
  [irlxyz_avatar]: https://gitlab.com/uploads/-/system/user/avatar/5895869/avatar.png?width=130

<!-- markdownlint-restore --><!-- markdownlint-disable -->
  [logo]: https://www.sr2.uk/readme/logo.png
  [website]: https://www.sr2.uk/?utm_source=gitlab&utm_medium=readme&utm_campaign=sr2c/terraform-cloudinit-tor&utm_content=website
  [gitlab]: https://go.sr2.uk/gitlab?utm_source=gitlab&utm_medium=readme&utm_campaign=sr2c/terraform-cloudinit-tor&utm_content=gitlab
  [contact]: https://go.sr2.uk/contact?utm_source=gitlab&utm_medium=readme&utm_campaign=sr2c/terraform-cloudinit-tor&utm_content=contact
  [irc]: ircs://libera.chat/sr2
  [linkedin]: https://www.linkedin.com/company/sr2uk/
  [email]: mailto:contact@sr2.uk
  [readme_header_img]: https://www.sr2.uk/readme/paid-support.png
  [readme_header_link]: https://www.sr2.uk/?utm_source=gitlab&utm_medium=readme&utm_campaign=sr2c/terraform-cloudinit-tor&utm_content=readme_header_link
  [readme_commercial_support_img]: https://www.sr2.uk/readme/paid-support.png
  [readme_commercial_support_link]: https://go.sr2.uk/commerical-support?utm_source=gitlab&utm_medium=readme&utm_campaign=sr2c/terraform-cloudinit-tor&utm_content=readme_commercial_support_link
<!-- markdownlint-restore -->
